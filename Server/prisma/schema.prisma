generator client {
    provider = "prisma-client"
    output   = "../generated/prisma"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

//Modelos
//Modelo roles
model Role {
    ID        BigInt    @id @default(autoincrement())
    Name      String    @unique @db.VarChar(50)
    Usuarios  Usuario[]
    CreatedAt DateTime  @default(now())
    UpdatedAt DateTime  @updatedAt
}

//Modelo Usuario
model Usuario {
    ID         BigInt  @id @default(autoincrement())
    Cedula     String  @unique @db.VarChar(50)
    Nombre     String  @db.VarChar(100)
    Roles      Role[]
    EstaActivo Boolean

    Ordenes   Orden[]
    Reservas  Reserva[]
    CreatedAt DateTime  @default(now())
    UpdatedAt DateTime  @updatedAt
}

//Modelo Ingrediente
model Ingrediente {
    ID                   BigInt                @id @default(autoincrement())
    Nombre               String                @db.VarChar(100)
    CantidadKilos        Float
    PlatilloIngredientes PlatilloIngrediente[]
    CreatedAt            DateTime              @default(now())
    UpdatedAt            DateTime              @updatedAt
}

//Modelo Platillo
model Platillo {
    ID                   BigInt                @id @default(autoincrement())
    Nombre               String                @db.VarChar(100)
    Precio               Float
    PlatilloIngredientes PlatilloIngrediente[]
    OrdenPlatillos       OrdenPlatillo[]
    CreatedAt            DateTime              @default(now())
    UpdatedAt            DateTime              @updatedAt
}

//Modelo PlatilloIngrediente
model PlatilloIngrediente {
    CantidadKilosIngrediente Float
    IDPlatillo               BigInt
    IDIngrediente            BigInt
    Platillo                 Platillo    @relation(fields: [IDPlatillo], references: [ID], onDelete: Cascade)
    Ingrediente              Ingrediente @relation(fields: [IDIngrediente], references: [ID], onDelete: Cascade)
    CreatedAt                DateTime    @default(now())
    UpdatedAt                DateTime    @updatedAt

    @@id([IDPlatillo, IDIngrediente])
}

//Modelo Mesa
model Mesa {
    ID          BigInt  @id @default(autoincrement())
    NumeroMesa  BigInt  @unique
    EstaOcupada Boolean

    Ordenes   Orden[]
    Reservas  Reserva[]
    CreatedAt DateTime  @default(now())
    UpdatedAt DateTime  @updatedAt
}

//Modelo Orden
model Orden {
    ID     BigInt @id @default(autoincrement())
    IDMesa BigInt
    Mesa   Mesa   @relation(fields: [IDMesa], references: [ID])

    IDUsuario BigInt
    Usuario   Usuario @relation(fields: [IDUsuario], references: [ID])

    FechaHora DateTime @default(now())
    Total     Float
    Estado    String   @db.VarChar(50)

    OrdenPlatillos OrdenPlatillo[]
    Factura        Factura?
    CreatedAt      DateTime        @default(now())
    UpdatedAt      DateTime        @updatedAt
}

//Modelo OrdenPlatillo
model OrdenPlatillo {
    ID      BigInt @id @default(autoincrement())
    IDOrden BigInt
    Orden   Orden  @relation(fields: [IDOrden], references: [ID])

    IDPlatillo BigInt
    Platillo   Platillo @relation(fields: [IDPlatillo], references: [ID])

    Cantidad  Int
    CreatedAt DateTime @default(now())
    UpdatedAt DateTime @updatedAt
}

//Modelo Factura 
model Factura {
    ID      BigInt @id @default(autoincrement())
    IDOrden BigInt @unique
    Orden   Orden  @relation(fields: [IDOrden], references: [ID])

    FechaHora  DateTime @default(now())
    TotalBruto Float
    Impuestos  Float
    Total      Float
    CreatedAt  DateTime @default(now())
    UpdatedAt  DateTime @updatedAt
}

//Modelo Reserva
model Reserva {
    ID              BigInt @id @default(autoincrement())
    CedulaCliente   String @db.VarChar(50)
    NombreCliente   String @db.VarChar(100)
    TelefonoCliente String @db.VarChar(20)

    IDMesa BigInt
    Mesa   Mesa   @relation(fields: [IDMesa], references: [ID])

    IDUsuario BigInt
    Usuario   Usuario @relation(fields: [IDUsuario], references: [ID])

    FechaReserva   DateTime
    HoraReserva    String   @db.VarChar(20)
    NumeroPersonas Int
    Nota           String?  @db.VarChar(255)
    CreatedAt      DateTime @default(now())
    UpdatedAt      DateTime @updatedAt
}
