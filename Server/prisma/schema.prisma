generator client {
    provider = "prisma-client-js"
    output   = "../node_modules/.prisma/client"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

//Modelos
//Modelo roles
model Role {
    ID        Int     @id  @default(autoincrement())
    Name      String    @unique @db.VarChar(50)
    Usuarios  Usuario[]
    CreatedAt DateTime  @default(now())
    UpdatedAt DateTime  @updatedAt
    Active    Boolean   @default(true)
}

//Modelo Usuario
model Usuario {
    ID     Int  @id @default(autoincrement())
    Cedula String  @unique @db.VarChar(50)
    Email  String  @unique
	Password String @db.VarChar(255)
    Nombre String  @db.VarChar(100)
	Apellido String @db.VarChar(100)
    Roles  Role[]
    Active Boolean @default(true)

    Ordenes   Orden[]
    Reservas  Reserva[]
    CreatedAt DateTime  @default(now())
    UpdatedAt DateTime  @updatedAt

	@@index([Cedula])
	@@index([Email])
	@@index([Nombre])
	@@index([Apellido])
}

//Modelo Ingrediente
model Ingrediente {
    ID                   Int                @id @default(autoincrement())
    Nombre               String                @db.VarChar(100)
    CantidadKilos        Float
    PlatilloIngredientes PlatilloIngrediente[]
    CreatedAt            DateTime              @default(now())
    UpdatedAt            DateTime              @updatedAt
    Active               Boolean               @default(true)
}

//Modelo Platillo
model Platillo {
    ID                   Int                @id @default(autoincrement())
    Nombre               String                @db.VarChar(100)
    Precio               Float
    PlatilloIngredientes PlatilloIngrediente[]
    OrdenPlatillos       OrdenPlatillo[]
    Active               Boolean               @default(true)
    CreatedAt            DateTime              @default(now())
    UpdatedAt            DateTime              @updatedAt
}

//Modelo PlatilloIngrediente
model PlatilloIngrediente {
    CantidadKilosIngrediente Float
    IDPlatillo               Int
    IDIngrediente            Int
    Platillo                 Platillo    @relation(fields: [IDPlatillo], references: [ID], onDelete: Cascade)
    Ingrediente              Ingrediente @relation(fields: [IDIngrediente], references: [ID], onDelete: Cascade)
    Active                   Boolean     @default(true)
    CreatedAt                DateTime    @default(now())
    UpdatedAt                DateTime    @updatedAt

    @@id([IDPlatillo, IDIngrediente])
}

//Modelo Mesa
model Mesa {
    ID          Int  @id @default(autoincrement())
    NumeroMesa  Int  @unique
    EstaOcupada Boolean @default(false) 

    Ordenes   Orden[]
    Reservas  Reserva[]
    Active    Boolean   @default(true)
    CreatedAt DateTime  @default(now())
    UpdatedAt DateTime  @updatedAt

	@@index([EstaOcupada])
	@@index([NumeroMesa])
}

//Modelo Orden
model Orden {
    ID     Int @id @default(autoincrement())
    IDMesa Int
    Mesa   Mesa   @relation(fields: [IDMesa], references: [ID])

    IDUsuario Int
    Usuario   Usuario @relation(fields: [IDUsuario], references: [ID])

    FechaHora DateTime @default(now())
    Total     Float
    Estado    String   @db.VarChar(50)

    OrdenPlatillos OrdenPlatillo[]
    Active         Boolean         @default(true)
    Factura        Factura?
    CreatedAt      DateTime        @default(now())
    UpdatedAt      DateTime        @updatedAt
}

//Modelo OrdenPlatillo
model OrdenPlatillo {
    ID      Int @id @default(autoincrement())
    IDOrden Int
    Orden   Orden  @relation(fields: [IDOrden], references: [ID])

    IDPlatillo Int
    Platillo   Platillo @relation(fields: [IDPlatillo], references: [ID])

    Cantidad  Int
    CreatedAt DateTime @default(now())
    UpdatedAt DateTime @updatedAt
    Active    Boolean  @default(true)
}

//Modelo Factura 
model Factura {
    ID      Int @id @default(autoincrement())
    IDOrden Int @unique
    Orden   Orden  @relation(fields: [IDOrden], references: [ID])

    TotalBruto Float
    Impuestos  Float
    Total      Float
    CreatedAt  DateTime @default(now())
    Active     Boolean  @default(true)

	@@index([CreatedAt])
}

//Modelo Reserva
model Reserva {
    ID              Int @id @default(autoincrement())
    CedulaCliente   String @db.VarChar(50)
    NombreCliente   String @db.VarChar(100)
    TelefonoCliente String @db.VarChar(20)

    IDMesa Int
    Mesa   Mesa   @relation(fields: [IDMesa], references: [ID])

    IDUsuario Int
    Usuario   Usuario @relation(fields: [IDUsuario], references: [ID])

    FechaReserva   DateTime
    HoraReserva    String   @db.VarChar(20)
    NumeroPersonas Int
    Nota           String?  @db.VarChar(255)
    CreatedAt      DateTime @default(now())
    UpdatedAt      DateTime @updatedAt
    Active         Boolean  @default(true)

	@@index([NombreCliente])
	@@index([CedulaCliente])
	@@index([TelefonoCliente])
	@@index([NumeroPersonas])

}
